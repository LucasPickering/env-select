<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js oranda-dark">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>env-select</title>
        <meta name="robots" content="noindex" />


        <!-- Custom HTML head -->
        
        <meta name="description" content="Easily switch between common values for arbitrary environment variables">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">
        <link rel="stylesheet" href="oranda-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "oranda-dark" : "oranda-dark";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('orandamdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('orandamdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('orandamdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('oranda-dark')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="introduction.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="install.html"><strong aria-hidden="true">2.</strong> Install</a></li><li class="chapter-item expanded "><a href="getting_started.html"><strong aria-hidden="true">3.</strong> Getting Started</a></li><li class="chapter-item expanded affix "><li class="part-title">User Guide</li><li class="chapter-item expanded "><a href="user_guide/key_concepts.html"><strong aria-hidden="true">4.</strong> Key Concepts</a></li><li class="chapter-item expanded "><a href="user_guide/env/index.html"><strong aria-hidden="true">5.</strong> Setting Environment Variables</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="user_guide/env/dynamic.html"><strong aria-hidden="true">5.1.</strong> Dynamic Values (Files & Shell Commands)</a></li><li class="chapter-item expanded "><a href="user_guide/env/multi.html"><strong aria-hidden="true">5.2.</strong> Multiple Values from a Single Source</a></li><li class="chapter-item expanded "><a href="user_guide/env/path.html"><strong aria-hidden="true">5.3.</strong> Adding to the PATH Variable</a></li><li class="chapter-item expanded "><a href="user_guide/env/kubernetes.html"><strong aria-hidden="true">5.4.</strong> Load Values from Kubernetes</a></li></ol></li><li class="chapter-item expanded "><a href="user_guide/inheritance.html"><strong aria-hidden="true">6.</strong> Inheritance & Cascading Configs</a></li><li class="chapter-item expanded "><a href="user_guide/side_effects.html"><strong aria-hidden="true">7.</strong> Side Effects</a></li><li class="chapter-item expanded "><a href="user_guide/run_advanced.html"><strong aria-hidden="true">8.</strong> es run and Shell Interactions</a></li><li class="chapter-item expanded affix "><li class="part-title">API Reference</li><li class="chapter-item expanded "><a href="api/application.html"><strong aria-hidden="true">9.</strong> Application</a></li><li class="chapter-item expanded "><a href="api/profile.html"><strong aria-hidden="true">10.</strong> Profile</a></li><li class="chapter-item expanded "><a href="api/value_source.html"><strong aria-hidden="true">11.</strong> Value Source</a></li><li class="chapter-item expanded "><a href="api/shell_support.html"><strong aria-hidden="true">12.</strong> Shell Support</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="oranda-dark">Oranda Dark</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="oranda-light">Oranda Light</button></li>

                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">env-select</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/LucasPickering/env-select" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="introduction"><a class="header" href="#introduction">Introduction</a></h1>
<p>env-select is a command line tool that makes it easy to define reusable shell environments. Its most common use case (but not only) is to manage deployed environments when working with webapps. For example, if you have a webapp that has local, staging, and production environments, you can use env-select to set environment variables corresponding to each environment:</p>
<pre><code class="language-toml">[applications.my_webapp.profiles.local.variables]
PROTOCOL = &quot;http&quot;
HOST = &quot;localhost&quot;
PORT = 3000

[applications.my_webapp.profiles.staging.variables]
PROTOCOL = &quot;https&quot;
HOST = &quot;staging.my.webapp&quot;
PORT = 443

[applications.my_webapp.profiles.production.variables]
PROTOCOL = &quot;https&quot;
HOST = &quot;production.my.webapp&quot;
PORT = 443
</code></pre>
<p>env-select integrates with your shell to make it easy to configure environments. There are two possible ways to use env-select's environments:</p>
<ul>
<li><code>es set</code> - Export values to modify your current shell</li>
<li><code>es run</code> - Run a single command under the environment, without modifying your shell</li>
</ul>
<p>Read on to <a href="./getting_started.html">Getting Started</a> to learn how to use env-select!</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="install"><a class="header" href="#install">Install</a></h1>
<p>See <a href="/artifacts">the artifacts page</a> to download and install <code>es</code> using your preferred method.</p>
<h2 id="install-shell-function"><a class="header" href="#install-shell-function">Install Shell Function</a></h2>
<p>While not strictly required, it's highly recommended to install the <code>es</code> shell function. This wraps the <code>es</code> binary command, allowing it to automatically modify your current shell environment with the <code>es set</code> subcommand. Otherwise, you'll have to manually pipe the output of <code>es set</code> to <code>source</code>.</p>
<blockquote>
<p>If you only plan to use the <code>es run</code> command, and don't care about shell tab completions, this is <strong>not relevant</strong>.</p>
</blockquote>
<p>This is necessary because a child process is not allowed to modify its parent's environment. That means the <code>es</code> process cannot modify the environment of the invoking shell. The wrapping shell function takes the output of <code>es</code> and runs it in that shell session to update the environment.</p>
<p>Here's how you install it:</p>
<h3 id="bash"><a class="header" href="#bash">Bash</a></h3>
<pre><code class="language-sh">echo 'eval &quot;$(es --shell bash init)&quot;' &gt;&gt; ~/.bashrc
</code></pre>
<h3 id="zsh"><a class="header" href="#zsh">Zsh</a></h3>
<pre><code class="language-sh">echo &quot;source &lt;(es --shell zsh init)&quot; &gt;&gt; ~/.zshrc
</code></pre>
<h3 id="fish"><a class="header" href="#fish">Fish</a></h3>
<pre><code class="language-sh">echo &quot;es --shell fish init | source&quot; &gt;&gt; ~/.config/fish/config.fish
</code></pre>
<p><strong>Restart your shell afterward to apply changes.</strong></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="getting-started"><a class="header" href="#getting-started">Getting Started</a></h1>
<h2 id="create-the-configuration-file"><a class="header" href="#create-the-configuration-file">Create the configuration file</a></h2>
<p>Once you've <a href="/artifacts">installed env-select</a>, setup is easy. All configuration is defined in the <a href="https://toml.io/en/">TOML</a> format. Create a file called <code>.env-select.toml</code> to hold your configuration. This file will apply to to your current directory <strong>and all descendent directories</strong>. In other words, any time you run the <code>es</code> command, it will search <em>up</em> the directory tree the <code>.env-select.toml</code> file.</p>
<p>Here's an example <code>.env-select.toml</code> file:</p>
<pre><code class="language-toml">[applications.server.profiles.dev]
variables = {SERVICE1 = &quot;dev&quot;, SERVICE2 = &quot;also-dev&quot;}

[applications.server.profiles.prd]
variables = {SERVICE1 = &quot;prd&quot;, SERVICE2 = &quot;also-prd&quot;}

[applications.db.profiles.dev]
variables = {DATABASE = &quot;dev&quot;, DB_USER = &quot;root&quot;,  DB_PASSWORD = &quot;badpw&quot;}
[applications.db.profiles.stg]
variables = {DATABASE = &quot;stg&quot;, DB_USER = &quot;root&quot;, DB_PASSWORD = &quot;goodpw&quot;}
[applications.db.profiles.prd]
variables = {DATABASE = &quot;prd&quot;, DB_USER = &quot;root&quot;, DB_PASSWORD = &quot;greatpw&quot;}
</code></pre>
<p>Now, you can easily switch between the defined values with <code>es</code>.</p>
<h2 id="select-a-set-of-variables"><a class="header" href="#select-a-set-of-variables">Select a set of variables</a></h2>
<p>In the config above, we've already predefined an application called <code>server</code>, which consists of two profiles, <code>dev</code> and <code>prd</code>. We can select between those profiles by providing the <em>application</em> name.</p>
<pre><code class="language-sh">&gt; es set server
❯ === dev ===
SERVICE1=dev
SERVICE2=also-dev

  === prd ===
SERVICE1=prd
SERVICE2=also-prd

&gt; echo $SERVICE1 $SERVICE2
dev also-dev
</code></pre>
<p>If you know the name of the profile you want to select, you can skip the prompt by providing it directly to the command:</p>
<pre><code class="language-sh">&gt; es set server dev
&gt; echo $SERVICE1 $SERVICE2
dev also-dev
</code></pre>
<h2 id="run-a-single-command"><a class="header" href="#run-a-single-command">Run a single command</a></h2>
<p>If you want to run only a single command in the modified environment, rather than modify the entire shell, you can use <code>es run</code> instead of <code>es set</code>:</p>
<pre><code class="language-sh"># Select the profile to use for the `server` application, then run the command
&gt; es run server -- echo $SERVICE1 $SERVICE2
❯ === dev ===
SERVICE1=dev
SERVICE2=also-dev

  === prd ===
SERVICE1=prd
SERVICE2=also-prd

dev also-dev
# You can also specify the profile name up front
&gt; es run server dev -- echo $SERVICE1 $SERVICE2
dev also-dev
# The surrounding environment is *not* modified
&gt; echo $SERVICE1 $SERVICE2

</code></pre>
<p><code>--</code> is required to delineate the arguments handled by <code>es</code> from the command being executed. The executed command is executed in your shell, so you can access shell features such as pipes and aliases.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="key-concepts"><a class="header" href="#key-concepts">Key Concepts</a></h1>
<p>env-select operates with a few different building blocks. From largest to smallest (rougly), they are: <a href="user_guide/../api/application.html">Application</a>, <a href="user_guide/../api/profile.html">Profile</a>, Variable Mapping, <a href="user_guide/../api/value_source.html">Value Source</a> and Side Effect.</p>
<h2 id="application"><a class="header" href="#application">Application</a></h2>
<p>An application is a group. &quot;Application&quot; in this case is a synonym for &quot;use case&quot; or &quot;purpose&quot;. Each profile in an application accomplishes different versions of the same goal. Applications tend to map one-to-one to services or code repositories, but don't necessarily have to.</p>
<pre><code class="language-sh"># dev
SERVICE1=dev
SERVICE2=also-dev

# prd
SERVICE1=prd
SERVICE2=also-prd
</code></pre>
<p>See the <a href="user_guide/../api/application.html">API reference</a> for more.</p>
<h2 id="profile"><a class="header" href="#profile">Profile</a></h2>
<p>A profile is a set of variable mappings.</p>
<pre><code class="language-sh">SERVICE1=dev
SERVICE2=also-dev
</code></pre>
<p>See the <a href="user_guide/../api/profile.html">API reference</a> for more.</p>
<h2 id="variable-mapping"><a class="header" href="#variable-mapping">Variable Mapping</a></h2>
<p>A key mapped to a value source. Variables are selected as part of a profile.</p>
<pre><code class="language-sh">SERVICE1=dev
</code></pre>
<h2 id="value-source"><a class="header" href="#value-source">Value Source</a></h2>
<p>A value source is a means of deriving a string for the shell. Typically this is just a literal string: <code>&quot;abc&quot;</code>, but it can also be a command that will be evaluated to a string at runtime.</p>
<pre><code class="language-sh">dev # Literal
$(echo prd) # Command
</code></pre>
<p>See the <a href="user_guide/../api/value_source.html">API reference</a> for more.</p>
<h2 id="side-effect"><a class="header" href="#side-effect">Side Effect</a></h2>
<p>A side effect is a pairing of procedures: one to execute during environment, and one during teardown. These are used to perform environment configuration beyond environment variables. An example of a side effect is creating a file during setup, then deleting it during teardown.</p>
<p>See the <a href="user_guide/./side_effects.html">user guide</a> for more.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="setting-environment-variables"><a class="header" href="#setting-environment-variables">Setting Environment Variables</a></h1>
<p>The primary purpose of env-select is to configure environment variables. The most common way to do this is to provide static values:</p>
<pre><code class="language-toml">[applications.server.profiles.dev]
variables = {SERVICE1 = &quot;dev&quot;, SERVICE2 = &quot;also-dev&quot;}

[applications.server.profiles.prd]
variables = {SERVICE1 = &quot;prd&quot;, SERVICE2 = &quot;also-prd&quot;}
</code></pre>
<p>Beyond these simple values, there are several ways to customize how values are computed. Read on to learn more.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="dynamic-values"><a class="header" href="#dynamic-values">Dynamic Values</a></h1>
<p>If your values are not statically known, there are several ways to load dynamic values. Fore more detailed information on each option, see <a href="user_guide/env/../../api/value_source.html">the API reference</a>.</p>
<h2 id="shell-command"><a class="header" href="#shell-command">Shell Command</a></h2>
<p>You can specify a shell command to generate a value. This allows you to provide values that can change over time, or secrets that you don't want appearing in the file. For example:</p>
<pre><code class="language-toml">[applications.db.profiles.dev.variables]
DATABASE = &quot;dev&quot;
DB_USER = &quot;root&quot;
DB_PASSWORD = {type = &quot;command&quot;, command = &quot;curl https://www.random.org/strings/?format=plain&amp;len=10&amp;num=1&amp;loweralpha=on&quot;, sensitive = true}
</code></pre>
<p>When the <code>dev</code> profile is selected for the <code>db</code> app, the <code>DB_PASSWORD</code> value will be randomly generated from a URL. The <code>sensitive</code> field is an <em>optional</em> field that will mask the value in informational logging.</p>
<p>The command is executed in the shell detected by env-select as your default (or the shell passed with <code>--shell</code>).</p>
<h2 id="file"><a class="header" href="#file">File</a></h2>
<p>You can also load values from a file:</p>
<pre><code class="language-toml">[applications.db.profiles.dev.variables]
DATABASE = {type = &quot;file&quot;, path = &quot;database.txt&quot;}
</code></pre>
<p><code>database.txt</code>:</p>
<pre><code>dev
</code></pre>
<p>And now run it:</p>
<pre><code class="language-sh">&gt; es run db dev -- printenv
DATABASE=dev
</code></pre>
<p>The file path will be relative to <strong>the config file in which the path is defined</strong>. For example, if you have two <code>.env-select.toml</code> files:</p>
<pre><code class="language-toml"># ~/code/.env-select.toml
[applications.server.profiles.dev.variables]
SERVICE1 = {type = &quot;file&quot;, path = &quot;service1.txt&quot;}
</code></pre>
<pre><code class="language-toml"># ~/.env-select.toml
[applications.server.profiles.dev.variables]
SERVICE2 = {type = &quot;file&quot;, path = &quot;service2.txt&quot;}
</code></pre>
<p>In this scenario, <code>SERVICE1</code> will be loaded from <code>~/code/service1.txt</code> while <code>SERVICE2</code> will be loaded from <code>~/service2.txt</code>, <strong>regardless of where env-select is invoked from</strong>.</p>
<p>This value source combines well with the <code>multiple</code> field to load <code>.env</code> files (see next section).</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="multiple-values-from-a-single-source"><a class="header" href="#multiple-values-from-a-single-source">Multiple Values from a Single Source</a></h1>
<p>If you want to load multiple values from a single source, you can use the <code>multiple = true</code> flag. This will tell env-select to expect a mapping of <code>VARIABLE=value</code> as output from the value source, with one entry per line. Whitespace lines and anything preceded by a <code>#</code> will be ignored (this is the standard <code>.env</code> file format).</p>
<p>This means that <strong>the key associated with this entry in the <code>variables</code> map will be ignored</strong>.</p>
<pre><code class="language-toml">[applications.db.profiles.dev.variables]
DATABASE = &quot;dev&quot;
creds = {type = &quot;file&quot;, path = &quot;creds.env&quot;, multiple = true}
</code></pre>
<p><code>creds.env</code>:</p>
<pre><code class="language-sh">DB_USER=root
DB_PASSWORD=hunter2
</code></pre>
<p><code>creds</code> will now be expanded into multiple variables:</p>
<pre><code class="language-sh">&gt; es run db dev -- printenv
DATABASE=dev
DB_USER=root
DB_PASSWORD=hunter2
</code></pre>
<p>Notice the <code>creds</code> key never appears in the environment; this is just a placeholder. You can use any key you want here.</p>
<h2 id="filtering-loaded-values"><a class="header" href="#filtering-loaded-values">Filtering Loaded Values</a></h2>
<p>If you want to load only <em>some</em> values from a source, you can filter which are loaded by passing a list of variables to <code>multiple</code>. This is useful in scenarios where you dump an entire environment. For example:</p>
<pre><code class="language-toml">[applications.db.profiles.dev.variables]
DATABASE = &quot;dev&quot;
creds = {type = &quot;command&quot;, command = &quot;ssh me@remote printenv&quot;, multiple = [&quot;DB_USER&quot;, &quot;DB_PASSWORD&quot;]}
</code></pre>
<p>This will only load the <code>DB_USER</code> and <code>DB_PASSWORD</code> variables:</p>
<pre><code class="language-sh">&gt; es run db dev -- printenv
DATABASE=dev
DB_USER=root
DB_PASSWORD=hunter2
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="adding-to-the-path-variable"><a class="header" href="#adding-to-the-path-variable">Adding to the PATH Variable</a></h1>
<p>If you want to modify the <code>PATH</code> variable, typically you just want to add to it, rather than replace it. Because of this, env-select will treat the variable <code>PATH</code> specially. It will append to the beginning, using <code>:</code> as a separator:</p>
<pre><code class="language-toml">[applications.server.profiles.dev.variables]
PATH = &quot;~/.bin&quot;
</code></pre>
<pre><code class="language-sh">&gt; printenv PATH
/bin:/usr/bin
&gt; es run server dev -- printenv PATH
~/.bin:/bin:/usr/bin
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="load-values-from-kubernetes"><a class="header" href="#load-values-from-kubernetes">Load Values from Kubernetes</a></h1>
<p>If you want to load one or more values from a Kubernetes pod, you can do that with the <code>command</code> value source:</p>
<pre><code class="language-toml">[applications.my-service.profile.dev]
variables.DB_PASSWORD = {type = &quot;command&quot;, sensitive = true, command = &quot;kubectl exec -n development api -- printenv DB_PASSWORD&quot;}
</code></pre>
<p>Loading multiple variables is easy too:</p>
<pre><code class="language-toml">[applications.my-service.profile.dev]
variables.db_creds = {type = &quot;command&quot;, sensitive = true, multiple = [&quot;DB_USERNAME&quot;, &quot;DB_PASSWORD&quot;], command = &quot;kubectl exec -n development api -- printenv&quot;}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="inheritance--cascading-configs"><a class="header" href="#inheritance--cascading-configs">Inheritance &amp; Cascading Configs</a></h1>
<p>env-select supports two different features that enable sharing configuration: cascading configs and profile inheritance. Cascading configs automatically combines multiple <code>.env-select.toml</code> files into one config, while profile inheritance allows you to explicitly re-use variable mappings and side effects from other profiles.</p>
<h2 id="cascading-configs"><a class="header" href="#cascading-configs">Cascading configs</a></h2>
<p>On every execution, env-select will scan the current directory for a file called <code>.env-select.toml</code> and parse it for a config. In addition to that, it will walk up the directory tree and check each ancestor directory tree for the same file. If multiple files are found, the results will be merged together, <strong>down to the profile level only</strong>. Lower config files having higher precedence. For example, if we execute <code>es set SERVICE1</code> in <code>~/code/</code>:</p>
<pre><code class="language-toml"># ~/code/.env-select.toml
[applications.server.profiles.dev]
variables = {SERVICE1 = &quot;secret-dev-server&quot;, SERVICE2 = &quot;another-secret-dev-server&quot;}
[applications.server.profiles.stg]
variables = {SERVICE1 = &quot;secret-stg-server&quot;, SERVICE2 = &quot;another-secret-stg-server&quot;}
</code></pre>
<pre><code class="language-toml"># ~/.env-select.toml
[applications.server.profiles.dev]
variables = {SERVICE1 = &quot;dev&quot;, SERVICE2 = &quot;also-dev&quot;}
[applications.server.profiles.prd]
variables = {SERVICE1 = &quot;prd&quot;, SERVICE2 = &quot;also-prd&quot;}
</code></pre>
<p>then our resulting config, at execution time, will look like:</p>
<pre><code class="language-toml"># Note: this config never exists in the file system, only in memory during program execution

# From ~/code/.env-select.toml (higher precedence)
[applications.server.profiles.dev]
variables = {SERVICE1 = &quot;dev&quot;, SERVICE2 = &quot;also-dev&quot;}
[applications.server.profiles.prd]
variables = {SERVICE1 = &quot;prd&quot;, SERVICE2 = &quot;also-prd&quot;}

# From ~/.env-select.toml (no value in ~/code/.env-select.toml)
[applications.server.profiles.stg]
variables = {SERVICE1 = &quot;secret-stg-server&quot;, SERVICE2 = &quot;another-secret-stg-server&quot;}
</code></pre>
<p>To see where env-select is loading configs from, and how they are being merged together, run the command with the <code>--verbose</code> (or <code>-v</code>) flag.</p>
<h2 id="profile-inheritance"><a class="header" href="#profile-inheritance">Profile Inheritance</a></h2>
<p>In addition to top-level merging of multiple config files, env-select also supports inheritance between profiles, via the <code>extends</code> field on a profile. For example:</p>
<pre><code class="language-toml">[applications.server.profiles.base]
variables = {PROTOCOL = &quot;https&quot;}
[applications.server.profiles.dev]
extends = [&quot;base&quot;]
variables = {SERVICE1 = &quot;dev&quot;, SERVICE2 = &quot;also-dev&quot;}
[applications.server.profiles.prd]
extends = [&quot;base&quot;]
variables = {SERVICE1 = &quot;prd&quot;, SERVICE2 = &quot;also-prd&quot;}
</code></pre>
<p>During execution, env-select will merge each profile with its parent(s):</p>
<pre><code class="language-sh">&gt; es set server
❯ === base ===
PROTOCOL=https

  === dev ===
SERVICE1=dev
SERVICE2=also-dev
PROTOCOL=https

  === prd ===
SERVICE1=prd
SERVICE2=also-prd
PROTOCOL=https
</code></pre>
<p>The profile name given in <code>extends</code> is assumed to be a profile of the same application. To extend a profile from another application, use the format <code>application/profile</code>:</p>
<pre><code class="language-toml">[applications.common.profiles.base]
variables = {PROTOCOL = &quot;https&quot;}
[applications.server.profiles.dev]
extends = [&quot;common/base&quot;]
variables = {SERVICE1 = &quot;dev&quot;, SERVICE2 = &quot;also-dev&quot;}
[applications.server.profiles.prd]
extends = [&quot;common/base&quot;]
variables = {SERVICE1 = &quot;prd&quot;, SERVICE2 = &quot;also-prd&quot;}
</code></pre>
<h3 id="multiple-inheritance-and-precedence"><a class="header" href="#multiple-inheritance-and-precedence">Multiple Inheritance and Precedence</a></h3>
<p>Each profile can extend multiple parents. If two parents have conflicting values, the <strong>left-most</strong> parent has precedence:</p>
<pre><code class="language-toml">[applications.server.profiles.base1]
variables = {PROTOCOL = &quot;https&quot;}
[applications.server.profiles.base2]
variables = {PROTOCOL = &quot;http&quot;}
[applications.server.profiles.dev]
extends = [&quot;base1&quot;, &quot;base2&quot;]
variables = {SERVICE1 = &quot;dev&quot;, SERVICE2 = &quot;also-dev&quot;}
</code></pre>
<p>The value from <code>base1</code> is used:</p>
<pre><code class="language-sh">&gt; es run server dev -- printenv PROTOCOL
https
</code></pre>
<p>Inheritance is applied recursively, meaning you can have arbitrarily large inheritance trees, <strong>as long as there are no cycles</strong>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="side-effects"><a class="header" href="#side-effects">Side Effects</a></h1>
<p>Side effects allow you to configure your environment beyond simple environment variables, using imperative commands. Each side effects has two commands: setup and teardown. Additionally, there are two points at which side effects can execute: pre-export (before environment variables are exported) and post-export (with environment variables available). So there are four side effect stages in total (in their order of execution):</p>
<ul>
<li>Pre-export setup</li>
<li>Post-export setup</li>
<li>Post-export teardown</li>
<li>Pre-export teardown</li>
</ul>
<p>The meaning of &quot;setup&quot; and &quot;teardown&quot; varies based on what subcommand you're running: <code>es set</code> has no teardown stage, as its purpose is to leave the configured environment in place. Currently there is no way to tear down an <code>es set</code> environment (see <a href="https://github.com/LucasPickering/env-select/issues/37">#37</a>). For <code>es run</code>, setup occurs before executing the given command, and teardown occurs after.</p>
<p>While supplying both setup and teardown commands isn't required, it's best practice to revert whatever changes your setup command may have made. You should only omit the teardown function if your setup doesn't leave any lingering changes in the environment.</p>
<h2 id="examples"><a class="header" href="#examples">Examples</a></h2>
<p>Given this config:</p>
<pre><code class="language-toml">[applications.server.profiles.base]
# These commands *cannot* access the constructed environment
pre_export = [
  # Native commands - not executed through the shell
  {setup = [&quot;touch&quot;, &quot;host.txt&quot;], teardown = [&quot;rm&quot;, &quot;-f&quot;, &quot;host.txt&quot;]}
]
# These commands can use the constructed environment
post_export = [
  # Shell command - no teardown needed because the above command handles it
  {setup = &quot;echo https://$SERVICE1 &gt; host.txt&quot;}
]


[applications.server.profiles.dev]
extends = [&quot;base&quot;]
variables = {SERVICE1 = &quot;dev&quot;, SERVICE2 = &quot;also-dev&quot;}

[applications.server.profiles.prd]
extends = [&quot;base&quot;]
variables = {SERVICE1 = &quot;prd&quot;, SERVICE2 = &quot;also-prd&quot;}
</code></pre>
<p>This will execute in the followingn order for <code>es set</code>:</p>
<pre><code class="language-sh">&gt; es set server dev
# 1. Execute pre-export setup (host.txt is created)
# 2. Construct environment
# 3. Execute post-export setup (host URL is written to host.txt)
# 4. Environment is exported to your shell
&gt; echo $SERVICE1
dev
&gt; cat host.txt
https://dev
</code></pre>
<p>And for <code>es run</code>:</p>
<pre><code class="language-sh">&gt; es run server dev -- cat host.txt
# 1. Execute pre-export setup (host.txt is created)
# 2. Construct environment
# 3. Execute post-export setup (host URL is written to host.txt)
# 4. `cat host.txt`
https://dev
# 5. Execute post-export teardown (in this case, nothing)
# 6. Clear constructed environment variables
# 7. Execute pre-export teardown (host.txt is deleted)
&gt; cat host.txt
cat: host.txt: No such file or directory
</code></pre>
<h2 id="ordering"><a class="header" href="#ordering">Ordering</a></h2>
<p>Side effects are executed in their order of definition for setup, and the <strong>reverse</strong> order for teardown. This is to enable side effects that depend on each other; the dependents are torn down before the parents are.</p>
<h2 id="inheritance"><a class="header" href="#inheritance">Inheritance</a></h2>
<p>Inherited side effects are executed <em>before</em> side effects defined in the selected profile during setup, and therefore <em>after</em> during teardown. For profiles with multiple parents, the <em>left-most</em> parent's side effects will execute first.</p>
<p>An example of a config with inheritance:</p>
<pre><code class="language-toml">[applications.server.profiles.base1]
pre_export = [{setup = &quot;echo base1 setup&quot;, teardown = &quot;echo base1 teardown&quot;}]

[applications.server.profiles.base2]
pre_export = [{setup = &quot;echo base2 setup&quot;, teardown = &quot;echo base2 teardown&quot;}]

[applications.server.profiles.child]
extends = [&quot;base1&quot;, &quot;base2&quot;]
pre_export = [{setup = &quot;echo child setup&quot;, teardown = &quot;echo child teardown&quot;}]
</code></pre>
<p>And how the inheritance would resolve for the <code>child</code> profile:</p>
<pre><code class="language-toml">[applications.server.profiles.child]
pre_export = [
  {setup = &quot;echo base1 setup&quot;, teardown = &quot;echo base1 teardown&quot;},
  {setup = &quot;echo base2 setup&quot;, teardown = &quot;echo base2 teardown&quot;},
  {setup = &quot;echo child setup&quot;, teardown = &quot;echo child teardown&quot;},
]
</code></pre>
<p>Here's the order of command execution:</p>
<pre><code class="language-sh">&gt; es run server child -- echo hello
base1 setup
base2 setup
child setup
hello
child teardown
base2 teardown
base1 teardown
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="es-run-and-shell-interactions"><a class="header" href="#es-run-and-shell-interactions"><code>es run</code> and Shell Interactions</a></h1>
<p>You may want to use <code>es run</code> in combination with shell features such as quotes, variable expansion, and command substitution. The general rule with <code>es run</code> is:</p>
<blockquote>
<p><strong>The passed command will be executed exactly as the same as if <code>es run</code> weren't there, except with a different set of environment variables.</strong></p>
</blockquote>
<p>Here's a concrete example:</p>
<pre><code class="language-toml"># We'll use this profile for all examples
[applications.server.profiles.dev]
variables.SERVICE1 = &quot;dev&quot;
variables.SERVICE2 = &quot;also-dev&quot;
</code></pre>
<pre><code class="language-sh"># These two invocations of `echo` will look exactly the same to the shell
es run server dev -- echo 'hi'
echo 'hi'
</code></pre>
<p>These two commands will behave exactly the same. In other words, if you're not sure how your command will be executed, ignore everything up to and including the <code>--</code>, and that's what the shell will see.</p>
<p>This allows you to add <code>es run</code> to any existing shell command without having to mess around with quotes and backslashes. Here's a more complex example where it's handy:</p>
<pre><code class="language-sh"># Note: this is how you escape single quotes in fish. This command may look
# slightly different in other shells.
es run server dev -- psql -c 'select id from products where cost = \'$30\';'
</code></pre>
<p>This will pass the exact string <code>select id from products where cost = '$30';</code> to <code>psql</code>, without any variable expansion or other shell tomfoolery.</p>
<blockquote>
<p>If you encounter any scenarios where the executed command does <em>not</em> behave the same as passing it directly to the shell, please <a href="https://github.com/LucasPickering/env-select/issues/new">file a bug</a>.</p>
</blockquote>
<h2 id="intentional-variable-expansion"><a class="header" href="#intentional-variable-expansion">Intentional Variable Expansion</a></h2>
<p>By default, there are two ways to handle variable expansion with <code>es run</code>: before invoking <code>es</code>, and not at all:</p>
<pre><code class="language-sh">es run server dev -- echo $SERVICE1 # prints &quot;&quot;
es run server dev -- echo '$SERVICE1' # prints &quot;$SERVICE1&quot;
</code></pre>
<p>In the first example, <code>$SERVICE1</code> is expanded by the shell <em>before</em> <code>es</code> is executed. In the second example, the single quotes prevent the shell from ever expanding <code>$SERVICE1</code>.</p>
<p>If you <em>want</em> a variable to be expanded after exporting the profile before executing the command, e.g. if you want to use a variable defined by your profile, you'll need to manually invoke a subshell:</p>
<pre><code class="language-sh">es run server dev -- fish -c 'echo $SERVICE1' # prints &quot;dev&quot;
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="application-1"><a class="header" href="#application-1">Application</a></h1>
<p>An application is the highest level of configuration resource in env-select. An application generally corresponds 1:1 with a deployed service or code repository. An application is essentially just a container for profiles. Here are some example application configurations:</p>
<pre><code class="language-toml">[applications.server.profiles.variables.dev]
variables = {SERVICE1 = &quot;dev&quot;, SERVICE2 = &quot;also-dev&quot;}
[applications.server.profiles.variables.prd]
variables = {SERVICE1 = &quot;prd&quot;, SERVICE2 = &quot;also-prd&quot;}

# This application has no profiles, but is still valid to configure
[applications.empty]
</code></pre>
<h2 id="fields"><a class="header" href="#fields">Fields</a></h2>
<div class="table-wrapper"><table><thead><tr><th>Field</th><th>Type</th><th>Purpose</th></tr></thead><tbody>
<tr><td><code>profiles</code></td><td><code>table</code></td><td>Name:profile mapping for all profiles of this application</td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="profile-1"><a class="header" href="#profile-1">Profile</a></h1>
<p>A profile is a collection of variable mappings and side effects. It generally maps to a single environment for a deployed application. Here are some example profiles:</p>
<pre><code class="language-toml">[applications.server.profiles.variables.dev]
variables = {SERVICE1 = &quot;dev&quot;, SERVICE2 = &quot;also-dev&quot;}
[applications.server.profiles.variables.prd]
variables = {SERVICE1 = &quot;prd&quot;, SERVICE2 = &quot;also-prd&quot;}

# This application has no profiles, but is still valid to configure
[applications.empty]

# These profiles are big, so we can use full table syntax instead of the
# inline syntax. This is purely stylistic; you can make your inline
# tables as big as your heart desires. See https://toml.io/en/v1.0.0#table
[applications.big.profiles.prof1.variables]
VAR1 = &quot;yes&quot;
VAR2 = &quot;yes&quot;
VAR3 = &quot;no&quot;
VAR4 = &quot;no&quot;
VAR5 = &quot;yes&quot;

[applications.big.profiles.prof2.variables]
VAR1 = &quot;no&quot;
VAR2 = &quot;no&quot;
VAR3 = &quot;no&quot;
VAR4 = &quot;yes&quot;
VAR5 = &quot;no&quot;
</code></pre>
<h2 id="disjoint-profiles"><a class="header" href="#disjoint-profiles">Disjoint Profiles</a></h2>
<p>Profiles within an app can define differing sets of variables, like so:</p>
<pre><code class="language-toml">[applications.db.profiles.dev]
variables = {DATABASE = &quot;dev&quot;, DB_USER = &quot;root&quot;}
[applications.db.profiles.stg]
variables = {DATABASE = &quot;stg&quot;, DB_USER = &quot;root&quot;, DB_PASSWORD = &quot;goodpw&quot;}
[applications.db.profiles.prd]
variables = {DATABASE = &quot;prd&quot;, DB_USER = &quot;root&quot;, DB_PASSWORD = &quot;greatpw&quot;}
</code></pre>
<p>The <code>dev</code> profile excludes the <code>DB_PASSWORD</code> variable. Beware though, whenever you switch to the dev profile, it will simply not output a value for <code>DB_PASSWORD</code>. That means if you switch from another profile, <code>DB_PASSWORD</code> will retain its old value! For this reason, it's generally best to define the same set of values for every profile in an app, and just use empty values as appropriate.</p>
<h2 id="fields-1"><a class="header" href="#fields-1">Fields</a></h2>
<div class="table-wrapper"><table><thead><tr><th>Field</th><th>Type</th><th>Purpose</th></tr></thead><tbody>
<tr><td><code>variables</code></td><td><code>table</code></td><td>Variable:value mapping to export</td></tr>
<tr><td><code>pre_export</code></td><td><code>array</code></td><td>Side effects to run <em>before</em> exporting variables</td></tr>
<tr><td><code>post_export</code></td><td><code>array</code></td><td>Side effects to run <em>after</em> exporting variables</td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="value-source-1"><a class="header" href="#value-source-1">Value Source</a></h1>
<p>There are multiple types of value sources. The type used for a value source is determined by the <code>type</code> field. For example:</p>
<pre><code class="language-toml"># All of these profiles will generate the same exported value for GREETING

# Literal shorthand - most common
[applications.example.profiles.shorthand.variables]
GREETING = &quot;hello&quot;

# Literal expanded form - generally not needed
[applications.example.profiles.literal.variables]
GREETING = {type = &quot;literal&quot;, value = &quot;hello&quot;}

[applications.example.profiles.command.variables]
GREETING = {type = &quot;command&quot;, command = &quot;echo hello&quot;}
</code></pre>
<h2 id="value-source-types"><a class="header" href="#value-source-types">Value Source Types</a></h2>
<div class="table-wrapper"><table><thead><tr><th>Value Source Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>literal</code></td><td>Literal static value</td></tr>
<tr><td><code>file</code></td><td>Load values from a file</td></tr>
<tr><td><code>command</code></td><td>Execute a shell command</td></tr>
</tbody></table>
</div>
<h2 id="common-fields"><a class="header" href="#common-fields">Common Fields</a></h2>
<p>All value sources support the following common fields:</p>
<div class="table-wrapper"><table><thead><tr><th>Option</th><th>Type</th><th>Default</th><th>Description</th></tr></thead><tbody>
<tr><td><code>multiple</code></td><td><code>boolean</code>, <code>string[]</code></td><td><code>false</code></td><td>Load a <code>VARIABLE=value</code> mapping, instead of just a <code>value</code>; Pass a list of variables to only load some. <a href="api/value_source.html#multiple-values-from-a-single-source">See more</a></td></tr>
<tr><td><code>sensitive</code></td><td><code>boolean</code></td><td><code>false</code></td><td>Hide value in console output</td></tr>
</tbody></table>
</div>
<h2 id="type-specific-fields"><a class="header" href="#type-specific-fields">Type-Specific Fields</a></h2>
<p>Each source type has its own set of available fields:</p>
<div class="table-wrapper"><table><thead><tr><th>Value Source Type</th><th>Field</th><th>Type</th><th>Default</th><th>Description</th></tr></thead><tbody>
<tr><td><code>literal</code></td><td><code>value</code></td><td><code>string</code></td><td><strong>Required</strong></td><td>Static value to export</td></tr>
<tr><td><code>file</code></td><td><code>path</code></td><td><code>string</code></td><td><strong>Required</strong></td><td>Path to the file, relative to <strong>the config file in which this is defined</strong></td></tr>
<tr><td><code>command</code></td><td><code>command</code></td><td><code>string</code></td><td><strong>Required</strong></td><td>Command to execute in a subshell; the output of the command will be exported</td></tr>
<tr><td><code>command</code></td><td><code>cwd</code></td><td><code>string</code></td><td><code>null</code></td><td>Directory from which to execute the command. Defaults to the directory from which <code>es</code> was invoked. Paths will be relative to the <code>.env-select.toml</code> file in which this command is defined.</td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="shell-support"><a class="header" href="#shell-support">Shell Support</a></h1>
<p>env-select supports the following shells:</p>
<ul>
<li>bash</li>
<li>zsh</li>
<li>fish</li>
</ul>
<p>If you use a different shell and would like support for it, please open an issue and I'll see what I can do!</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->

        <script>
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>

    </div>
    </body>
</html>
